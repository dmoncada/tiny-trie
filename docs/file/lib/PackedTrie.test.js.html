<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/PackedTrie.test.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="git+https://github.com/jnu/tiny-tree.git">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/BinaryString.js~BinaryString.html">BinaryString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/PackedTrie.js~PackedTrie.html">PackedTrie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Trie.js~Trie.html">Trie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-floor_log2">floor_log2</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createFrozenSync">createFrozenSync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createSync">createSync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-binaryString">binaryString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-packedTrie">packedTrie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-trie">trie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BASE64_CHAR_TO_INT">BASE64_CHAR_TO_INT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BASE64_INT_TO_CHAR">BASE64_INT_TO_CHAR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CHAR_WIDTH_FIELD">CHAR_WIDTH_FIELD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HEADER_WIDTH_FIELD">HEADER_WIDTH_FIELD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-OFFSET_SIGN_FIELD">OFFSET_SIGN_FIELD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-OFFSET_VAL_FIELD">OFFSET_VAL_FIELD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-POINTER_WIDTH_FIELD">POINTER_WIDTH_FIELD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TERMINAL">TERMINAL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TERMINUS">TERMINUS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-VERSION">VERSION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-VERSION_FIELD">VERSION_FIELD</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/PackedTrie.test.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/* eslint-env mocha */
import Trie from &apos;./Trie&apos;;
import PackedTrie from &apos;./PackedTrie&apos;;
import assert from &apos;assert&apos;;


describe(&apos;PackedTrie&apos;, () =&gt; {

    describe(&apos;constructor&apos;, () =&gt; {
        it(&apos;should parse header fields on init&apos;, () =&gt; {
            const encoded = &apos;BAAAAABAwIfboarzKTbjds1FDB&apos;;
            const trie = new PackedTrie(encoded);

            assert.strictEqual(trie.offset, 1);
            assert.deepEqual(trie.table, {
                &apos;\0&apos;: 0,
                f: 1,
                b: 2,
                o: 3,
                a: 4,
                r: 5,
                z: 6
            });
            assert.strictEqual(trie.wordWidth, 6);
            assert.strictEqual(trie.lastMask, parseInt(&apos;1&apos;, 2));
            assert.strictEqual(trie.pointerMask, parseInt(&apos;11&apos;, 2));
            assert.strictEqual(trie.pointerShift, 1);
            assert.strictEqual(trie.charMask, parseInt(&apos;111&apos;, 2));
            assert.strictEqual(trie.charShift, 3);
            assert.strictEqual(trie.data, encoded.substr(16));
        });

        it(&apos;should throw a version mismatch error if encoded string differs from reader version&apos;, () =&gt; {
            const encoded = &apos;BD/wAABAwIfboarzKTbjds1FDB&apos;;
            assert.throws(() =&gt; new PackedTrie(encoded));
        });
    });

    describe(&apos;test&apos;, () =&gt; {
        it(&apos;should determine whether an item is in the Trie&apos;, () =&gt; {
            const encoded = &apos;BAAAAABAwIfboarzKTbjds1FDB&apos;;
            const trie = new PackedTrie(encoded);

            [&apos;foo&apos;, &apos;bar&apos;, &apos;baz&apos;].forEach(w =&gt; assert(trie.test(w)));
            [&apos;fu&apos;, &apos;boer&apos;, &apos;batz&apos;].forEach(w =&gt; assert(!trie.test(w)));
        });

        it(&apos;should provide the same answers as a full Trie&apos;, () =&gt; {
            [
                [&apos;Africa&apos;, &apos;Asia&apos;, &apos;North America&apos;, &apos;South America&apos;, &apos;Europe&apos;, &apos;Antarctica&apos;],
                [&apos;red&apos;, &apos;yellow&apos;, &apos;green&apos;, &apos;aliceblue&apos;, &apos;pink&apos;, &apos;rose&apos;],
                [&apos;agricola&apos;, &apos;agricolae&apos;, &apos;agricolae&apos;, &apos;agricolam&apos;, &apos;agricol&#x101;&apos;],
                [&apos;&#x43B;&#x44E;&#x431;&#x438;&#x442;&#x44C;&apos;, &apos;&#x43B;&#x44E;&#x431;&#x43B;&#x44E;&apos;, &apos;&#x43B;&#x44E;&#x431;&#x438;&#x448;&#x44C;&apos;, &apos;&#x43B;&#x44E;&#x431;&#x438;&#x442;&apos;, &apos;&#x43B;&#x44E;&#x431;&#x438;&#x43C;&apos;, &apos;&#x43B;&#x44E;&#x431;&#x438;&#x442;&#x435;&apos;, &apos;&#x43B;&#x44E;&#x431;&#x44F;&#x442;&apos;]
            ].forEach(words =&gt; {
                const sdrow = words.slice().map(w =&gt; w.split(&apos;&apos;).reverse().join(&apos;&apos;));
                const trie = new Trie();
                words.forEach(w =&gt; trie.insert(w));
                words.forEach(w =&gt; assert(trie.test(w)));
                sdrow.forEach(s =&gt; assert(!trie.test(s)));
                const encoded = trie.freeze().encode();
                const packed = new PackedTrie(encoded);
                words.forEach(w =&gt; assert(packed.test(w)));
                sdrow.forEach(s =&gt; assert(!packed.test(s)));
            });
        });

        it(&apos;returns true for fuzzy matches when wildcard is given&apos;, () =&gt; {
            const trie = new Trie();
            trie.insert(&apos;foo&apos;);
            trie.insert(&apos;bar&apos;);
            trie.insert(&apos;bop&apos;);
            trie.insert(&apos;baz&apos;);
            const packed = new PackedTrie(trie.freeze().encode());

            assert(packed.test(&apos;***&apos;, {wildcard: &apos;*&apos;}));
            assert(packed.test(&apos;**r&apos;, {wildcard: &apos;*&apos;}));
            assert(packed.test(&apos;*az&apos;, {wildcard: &apos;*&apos;}));
            assert(packed.test(&apos;f**&apos;, {wildcard: &apos;*&apos;}));
            assert(packed.test(&apos;f*o&apos;, {wildcard: &apos;*&apos;}));
            assert(!packed.test(&apos;**x&apos;, {wildcard: &apos;*&apos;}));
        });

        it(&apos;returns true for partial matches when searching over prefixes&apos;, () =&gt; {
            const trie = new Trie();
            trie.insert(&apos;foo&apos;);
            trie.insert(&apos;food&apos;);
            trie.insert(&apos;foodology&apos;);
            const packed = new PackedTrie(trie.freeze().encode());

            assert(packed.test(&apos;fo&apos;, {prefix: true}));
            assert(packed.test(&apos;foodolog&apos;, {prefix: true}));
            assert(!packed.test(&apos;fob&apos;, {prefix: true}));
        });

        it(&apos;returns correct value for complex options cases&apos;, () =&gt; {
            const trie = new Trie();
            trie.insert(&apos;foo&apos;);
            trie.insert(&apos;bar&apos;);
            trie.insert(&apos;foobar&apos;);
            const packed = new PackedTrie(trie.freeze().encode());

            assert(packed.test(&apos;foo&apos;, {wildcard: &apos;*&apos;}));
            assert(packed.test(&apos;bar&apos;, {wildcard: &apos;*&apos;}));
            assert(!packed.test(&apos;foob&apos;, {wildcard: &apos;*&apos;, prefix: false}));
            assert(packed.test(&apos;foobar&apos;, {wildcard: &apos;*&apos;, prefix: false}));
            assert(packed.test(&apos;foob*&apos;, {wildcard: &apos;*&apos;, prefix: true}));
            assert(!packed.test(&apos;foob*&apos;, {wildcard: &apos;*&apos;, prefix: false}));
            assert(packed.test(&apos;**ob*&apos;, {wildcard: &apos;*&apos;, prefix: true}));
        });
    });

    describe(&apos;search&apos;, () =&gt; {
        const encoded = &apos;BMAAAAABAQfbgtoarleFBKNiPVzXZyxVzPV6vfbxWqzeazC0VCYQloNBYJg4BAIB&apos;;
        const trie = new PackedTrie(encoded);

        it(&apos;returns all matching values with wildcard&apos;, () =&gt; {
            assert.deepEqual(trie.search(&apos;*oo&apos;, {wildcard: &apos;*&apos;}), [&apos;foo&apos;, &apos;boo&apos;, &apos;goo&apos;]);
            assert.deepEqual(trie.search(&apos;*oo&apos;, {wildcard: &apos;*&apos;, prefix: true}), [
                &apos;foo&apos;, &apos;boo&apos;, &apos;goo&apos;, &apos;fool&apos;, &apos;tool&apos;]);
            assert.deepEqual(trie.search(&apos;f**&apos;, {wildcard: &apos;*&apos;}), [&apos;foo&apos;, &apos;far&apos;]);
            assert.deepEqual(trie.search(&apos;*x*&apos;, {wildcard: &apos;*&apos;}), []);
        });

        it(&apos;returns first match with wildcard&apos;, () =&gt; {
            assert(trie.search(&apos;f**&apos;, {wildcard: &apos;*&apos;, first: true}) === &apos;foo&apos;);
            assert(trie.search(&apos;**x&apos;, {wildcard: &apos;*&apos;, first: true}) === null);
            assert(trie.search(&apos;*&apos;, {wildcard: &apos;*&apos;, prefix: true}), [
                &apos;foo&apos;, &apos;bar&apos;, &apos;bare&apos;, &apos;fool&apos;, &apos;goo&apos;, &apos;far&apos;, &apos;boo&apos;, &apos;gar&apos;, &apos;tool&apos;]);
        });
    });

});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
